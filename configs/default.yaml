# Foosball RL Training Configuration

environment:
  # Ball physics
  ball_radius: 0.025
  ball_mass: 0.025
  ball_restitution: 0.8
  ball_rolling_friction: 0.001
  ball_spinning_friction: 0.001
  ball_lateral_friction: 0.01
  
  # Rod physics
  rod_linear_damping: 1.0
  rod_angular_damping: 1.0
  rod_restitution: 0.7
  
  # Motor controls
  max_velocity: 1.5
  max_force: 1.0
  
  # Goal lines
  goal_line_x_1: -0.75  # Team 1 (Red) goal
  goal_line_x_2: 0.75   # Team 2 (Blue) goal
  
  # Ball stuck detection
  max_stuck_steps: 5000

reward:
  # Dense reward scaling (reduced to balance sparse rewards)
  ball_velocity_scale: 2.0        # Reward for moving ball toward opponent goal
  goal_distance_penalty: 0.0001   # Small penalty for distance from goal
  player_ball_distance_scale: 0.05  # Reward for being close to ball
  ball_movement_scale: 0.05       # Reward for moving closer to ball
  contact_reward: 50              # Reward for contacting ball
  action_smoothness_penalty: 0.0  # Penalty for large action changes (disabled)
  
  # Sparse reward scaling (scaled down from original)
  goal_reward: 1000.0             # Reward for scoring goal
  concede_penalty: 500.0          # Penalty for opponent scoring
  
  # Ball stuck penalties
  stuck_penalty_threshold: 1000   # Steps before penalty
  stuck_penalty_per_step: 0.01    # Penalty per step when stuck
  
  # Inactivity penalty
  inactivity_penalty: 0.01        # Penalty for low ball velocity

curriculum:
  stage_1:
    name: "Dribble"
    description: "Ball stationary - learn basic hitting"
    duration_steps: 1_000_000
    max_episode_steps: 2000
    ball_spawn_x_range: [-0.6, 0.0]  # For player 1
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-0.2, -0.1]
    
  stage_2:
    name: "Pass"
    description: "Ball rolling toward you - learn interception"
    duration_steps: 1_000_000
    max_episode_steps: 2000
    ball_spawn_x: 0  # Center
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-1.0, -1.0]  # Fixed velocity
    
  stage_3:
    name: "Defend"
    description: "Ball shot fast at goal - learn defense"
    duration_steps: 1_000_000
    max_episode_steps: 2000
    ball_spawn_x_range: [-0.5, -0.4]
    ball_spawn_y_range: [-0.25, 0.25]
    ball_velocity_speed_range: [3.0, 4.5]
    
  stage_4:
    name: "Full Game"
    description: "Random play - learn complete strategy"
    duration_steps: 25_000_000
    max_episode_steps: 30000  # Extended for adversarial play (30 seconds)
    ball_spawn_x_range: [-0.6, 0.6]
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-1.0, 1.0]

training:
  # PPO hyperparameters
  learning_rate: 3e-4
  batch_size: 64
  n_steps: 2048
  n_epochs: 10
  gamma: 0.99
  gae_lambda: 0.95
  clip_range: 0.2
  entropy_coefficient: 0.01
  
  # Training setup
  num_parallel_envs: 4
  num_envs_render: 1  # Number of environments to render (0 or 1)
  
  # Checkpointing
  checkpoint_freq: 50_000
  
  # Early stopping and curriculum
  curriculum_enabled: true
  curriculum_progression_goals: 50  # Goals needed to advance stages

physics:
  gravity: -9.81
  physics_substeps: 4
  simulation_timestep: 0.0041666667  # 240 Hz

# Rod mapping for symmetric play
rod_mapping:
  # Red team (player 1) controls rods: 1, 2, 4, 6
  # Blue team (player 2) controls rods: 8, 7, 5, 3
  red_rods: [1, 2, 4, 6]
  blue_rods: [8, 7, 5, 3]
  
  # Mirror mapping for action symmetry
  # Rod 1 (red goalkeeper) <-> Rod 8 (blue goalkeeper)
  # Rod 2 (red defense) <-> Rod 7 (blue defense)
  # Rod 4 (red midfield) <-> Rod 5 (blue midfield)
  # Rod 6 (red forward) <-> Rod 3 (blue forward)
  action_mapping:
    1: 8
    2: 7
    4: 5
    6: 3
