# Foosball RL Training Configuration - Win Rate Curriculum (Tuned for Kicking)

environment:
  ball_radius: 0.025
  ball_mass: 0.025
  ball_restitution: 0.8
  ball_rolling_friction: 0.01   # Increased to prevent infinite sliding
  ball_spinning_friction: 0.01  # Increased to allow spin interactions
  ball_lateral_friction: 0.1    # CRITICAL: High friction allows "grip" for kicking
  rod_linear_damping: 0.1       # Reduced: Allows snappy, fast movement
  rod_angular_damping: 0.1
  rod_restitution: 0.7
  max_velocity: 1.0
  max_force: 1.0
  max_torque: 5.0
  goal_line_x_1: -0.725
  goal_line_x_2: 0.725
  max_stuck_steps: 525

reward:
  # Goal Rewards
  goal_reward: 10.0
  concede_penalty: 8.0
  
  # Dense Rewards
  ball_velocity_scale: 0.02
  contact_reward: 0.008
  player_ball_distance_scale: 0.001 
  midfield_reward_weight: 0.001
  ball_movement_scale: 0.003
  
  # Penalties
  stagnation_slide_steps: 150
  stagnation_slide_penalty: 0.03
  power_penalty_scale: 0.0
  rod_angle_penalty_scale: 0.003
  stuck_penalty_threshold: 500
  stuck_penalty_per_step: 0.005
  inactivity_threshold: 0.01
  inactivity_penalty: 0.008

curriculum:
  stage_1:
    name: "Dribble"
    description: "Ball stationary - learn basic hitting"
    duration_steps: 201_000_000 
    max_episode_steps: 500
    ball_spawn_x_range: [[-0.625, -0.55], [-0.45, -0.375], [-0.10, -0.02], [0.275, 0.33]]
    ball_spawn_y_range: [-0.2, 0.2]
    ball_velocity_range: [-0.1, 0.1]
    
  stage_2:
    name: "Pass"
    description: "Ball rolling toward you - learn interception"
    duration_steps: 202_000_000
    max_episode_steps: 800
    ball_spawn_x: [[-0.6, -0.5], [-0.4, -0.3], [-0.05, 0.075], [0.275, 0.4]]
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-0.4, -0.3]
    
  stage_3:
    name: "Defend"
    description: "Ball shot fast at goal - learn defense"
    duration_steps: 103_000_000
    max_episode_steps: 650
    ball_spawn_x_range: [[-0.5, -0.475], [-0.40, -0.275]]
    ball_spawn_y_range: [-0.25, 0.25]
    ball_velocity_speed_range: [2.5, 4.0]
    
  stage_4:
    name: "Full Game"
    description: "Random play - learn complete strategy"
    duration_steps: 525_000_000
    max_episode_steps: 5000
    ball_spawn_x_range: [[-0.6, 0.6]]
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-1.0, 1.0]

training:
  learning_rate: 3e-4
  batch_size: 128
  n_steps: 2048
  n_epochs: 20
  gamma: 0.99
  gae_lambda: 0.95
  clip_range: 0.1
  entropy_coefficient: 0.01   # Slight increase to prevent early mode collapse
  num_parallel_envs: 32
  num_envs_render: 0
  checkpoint_freq: 200_000
  save_path: "saves/ws9"

  # Curriculum Progression Requirements
  curriculum_enabled: true
  progression_min_goals: 150
  progression_win_rate: 0.6

physics:
  gravity: -9.81
  physics_substeps: 4
  simulation_timestep: 0.0041666667

rod_mapping:
  red_rods: [1, 2, 4, 6]
  blue_rods: [8, 7, 5, 3]
  action_mapping:
    1: 8
    2: 7
    4: 5
    6: 3
