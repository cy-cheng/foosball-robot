# Foosball RL Training Configuration

environment:
  # Ball physics
  ball_radius: 0.025
  ball_mass: 0.025
  ball_restitution: 0.8
  ball_rolling_friction: 0.001
  ball_spinning_friction: 0.001
  ball_lateral_friction: 0.01
  
  # Rod physics
  rod_linear_damping: 1.0
  rod_angular_damping: 0.1
  rod_restitution: 0.7
  
  # Motor controls
  max_velocity: 1.5
  max_force: 1.0
  max_torque: 2.0
  
  # Goal lines
  goal_line_x_1: -0.725  # Team 1 (Red) goal
  goal_line_x_2: 0.725   # Team 2 (Blue) goal
  
  # Ball stuck detection
  max_stuck_steps: 500

reward:
  # Dense reward scaling (reduced to balance sparse rewards)
  ball_velocity_scale: 0.0001       # Reward for moving ball toward opponent goal
  goal_distance_penalty: 0.08     # Small penalty for distance from goal
  player_ball_distance_scale: 0.0001  # Reward for being close to ball
  ball_movement_scale: 0.0001        # Reward for moving closer to ball
  contact_reward: 1.0               # Reward for contacting ball
  action_smoothness_penalty: 0.0    # Penalty for large action changes (disabled)
  rod_angle_penalty_scale: 0.00001    # Penalty for large rod angles (new)
  midfield_reward_weight: 0.0002      # Reward for keeping the ball in the middle of the field
  
  goal_reward: 250.0             # Reward for scoring goal
  concede_penalty: 400.0          # Penalty for opponent scoring
  
  # New penalties
  stagnation_slide_steps: 100        # Steps before slide stagnation penalty applies
  stagnation_slide_penalty: 0.00001    # Penalty for slide stagnation
  power_penalty_scale: 0.001         # Penalty for power usage
  stuck_penalty_threshold: 500       # Steps before ball stuck penalty applies
  stuck_penalty_per_step: 0.005       # Penalty per step when ball is stuck
  inactivity_threshold: 0.001        # Ball velocity below which inactivity penalty applies
  inactivity_penalty: 0.001           # Penalty for low ball velocity

curriculum:
  stage_1:
    name: "Dribble"
    description: "Ball stationary - learn basic hitting"
    duration_steps: 201_000_000
    max_episode_steps: 700
    ball_spawn_x_range: [[-0.625, -0.55], [-0.45, -0.375], [-0.10, -0.02], [0.275, 0.35]]  # Changed to list of intervals
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-0.01, 0.01]
    
  stage_2:
    name: "Pass"
    description: "Ball rolling toward you - learn interception"
    duration_steps: 202_000_000
    max_episode_steps: 1200
    ball_spawn_x: [[-0.6, -0.5], [-0.4, -0.3], [-0.05, 0.075], [0.275, 0.4]]
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-1.25, -0.5]  # Fixed velocity
    # ball_spawn_x_range is implicitly [0,0] for this stage, or can be specified as [[0,0]]
    
  stage_3:
    name: "Defend"
    description: "Ball shot fast at goal - learn defense"
    duration_steps: 103_000_000
    max_episode_steps: 650
    ball_spawn_x_range: [[-0.5, -0.475], [-0.40, -0.275]] # Changed to list of intervals
    ball_spawn_y_range: [-0.25, 0.25]
    ball_velocity_speed_range: [3.5, 4.5]
    
  stage_4:
    name: "Full Game"
    description: "Random play - learn complete strategy"
    duration_steps: 325_425_525
    max_episode_steps: 30000  # Extended for adversarial play (30 seconds)
    ball_spawn_x_range: [[-0.6, 0.6]] # Changed to list of intervals
    ball_spawn_y_range: [-0.3, 0.3]
    ball_velocity_range: [-1.0, 1.0]

training:
  # PPO hyperparameters
  learning_rate: 3e-4
  batch_size: 64
  n_steps: 2048
  n_epochs: 10
  gamma: 0.99
  gae_lambda: 0.95
  clip_range: 0.2
  entropy_coefficient: 0.015
  
  # Training setup
  num_parallel_envs: 32
  num_envs_render: 0  # Number of environments to render (0 or 1)
  
  # Checkpointing
  checkpoint_freq: 1_000_000
  
  # Early stopping and curriculum
  curriculum_enabled: true
  curriculum_progression_goals: 512  # Goals needed to advance stages
  save_path: "saves/ws6"

physics:
  gravity: -98.1
  physics_substeps: 4
  simulation_timestep: 0.0041666667  # 240 Hz

# Rod mapping for symmetric play
rod_mapping:
  # Red team (player 1) controls rods: 1, 2, 4, 6
  # Blue team (player 2) controls rods: 8, 7, 5, 3
  red_rods: [1, 2, 4, 6]
  blue_rods: [8, 7, 5, 3]
  
  # Mirror mapping for action symmetry
  # Rod 1 (red goalkeeper) <-> Rod 8 (blue goalkeeper)
  # Rod 2 (red defense) <-> Rod 7 (blue defense)
  # Rod 4 (red midfield) <-> Rod 5 (blue midfield)
  # Rod 6 (red forward) <-> Rod 3 (blue forward)
  action_mapping:
    1: 8
    2: 7
    4: 5
    6: 3
